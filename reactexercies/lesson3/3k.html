<!DOCTYPE html>
<html>
  <head>
    <title>React Basics</title>
  </head>
  <body>
    <div class="js-container"></div>

    <script src="https://unpkg.com/supersimpledev/react.js"></script>
    <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>
    <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>
    <script src="https://unpkg.com/supersimpledev/babel.js"></script>
    <script type="text/babel">

    function ChatInput({chatmessage,setChatMessage}){
      const [inputText,setInputText]=React.useState('');
      function sendInput(event){
        setInputText(event.target.value);
      }
      async function sendMessage(){
        const newChatMessages=[...chatmessage,{
       message:inputText,
       sender:"user",
       id:crypto.randomUUID()
      }]
      setChatMessage(newChatMessages);
   ;
      const response=await Chatbot.getResponseAsync(inputText);
       


       setChatMessage([...newChatMessages,{
       message:response,
       sender:"robot",
       id:crypto.randomUUID()
      }])
      setInputText(' ');
      }
      function HandleKey(event){
        console.log(event.key);
        if(event.key=='Enter'){
          {sendMessage()}
        }
        else if(event.key=='Escape'){
              setInputText(' ');
        }

      }
      return (
        <div>
        <input onChange={sendInput}  onKeyDown={HandleKey}value={inputText} placeholder="Send a message to placeholder" size="30"></input>
        <button onClick={sendMessage}>Send </button>
        </div>
      )
    }
    function ChatMessage(props){
      const {message,sender}=props;
      
          return(
        <div>
          {sender=="robot"&&<img src="robot.png" alt="not" width="50"></img>}
           
        {props.message}
         {sender=="user"&&<img src="user.png" alt="not" width="50"></img>}
       
        </div>
      )
  
    }
      
  function ChatMessages({chatmessage}){
return (
   <>   
         {
          chatmessage.map((chat,index) => {
            return(
            <ChatMessage message={chat.message} sender={chat.sender} key={index}/> 
            );
    
          })
         }
       </>
)
  }
function App(){
const [chatmessage,setChatMessage]=React.useState([{
     message: 'hello chatbot',
          sender: 'user',
          id: 'id1'
        }, {
          message: 'Hello! How can I help you?',
          sender: 'robot',
          id: 'id2'
        }, {
          message: 'can you get me todays date?',
          sender: 'user',
          id: 'id3'
        }, {
          message: 'Today is September 27',
          sender: 'robot',
          id: 'id4'
   }]);
 return(
 <>
  <ChatInput chatmessage={chatmessage} setChatMessage={setChatMessage}/>
 <ChatMessages chatmessage={chatmessage} /> 
 </>
  )
 
}
      const container = document.querySelector('.js-container');
      ReactDOM.createRoot(container).render(<App/>);
    </script>
  </body>
</html>